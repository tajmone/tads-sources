<html><head><link rel=stylesheet type="text/css" href="../libref.css"><title>adv3.h</title></head><body>
<table class=ban><tr><td><h1>adv3.h</h1><td align=right><a href="../file/adv3.h.html">documentation</a></table><pre>
<a name="1"></a>#charset "us-ascii"
<a name="2"></a>
<a name="3"></a>/*
<a name="4"></a> *   Copyright (c) 2000, 2006 Michael J. Roberts.  All Rights Reserved.
<a name="5"></a> *
<a name="6"></a> *   TADS 3 Library - main header
<a name="7"></a> *
<a name="8"></a> *   This file provides definitions of macros, properties, and other
<a name="9"></a> *   identifiers used throughout the library and in game source.
<a name="10"></a> *
<a name="11"></a> *   Each source code file in the library and in a game should generally
<a name="12"></a> *   #include this header near the top of the source file.
<a name="13"></a> */
<a name="14"></a>
<a name="15"></a>#ifndef ADV3_H
<a name="16"></a>#define ADV3_H
<a name="17"></a>
<a name="18"></a>/* ------------------------------------------------------------------------ */
<a name="19"></a>/*
<a name="20"></a> *   Include the system headers that we depend upon.  We include these here
<a name="21"></a> *   so that each game source file will pick up the same set of system
<a name="22"></a> *   headers in the same order, which is important for intrinsic function
<a name="23"></a> *   set definitions.
<a name="24"></a> */
<a name="25"></a>#include &lt;tads.h&gt;
<a name="26"></a>#include &lt;tok.h&gt;
<a name="27"></a>#include &lt;t3.h&gt;
<a name="28"></a>#include &lt;vector.h&gt;
<a name="29"></a>#include &lt;strbuf.h&gt;
<a name="30"></a>#include &lt;file.h&gt;
<a name="31"></a>#include &lt;dict.h&gt;
<a name="32"></a>
<a name="33"></a>
<a name="34"></a>/* ------------------------------------------------------------------------ */
<a name="35"></a>/*
<a name="36"></a> *   Establish the default dictionary for the game's player command parser
<a name="37"></a> *   vocabulary.
<a name="38"></a> */
<a name="39"></a>dictionary cmdDict;
<a name="40"></a>
<a name="41"></a>/* ------------------------------------------------------------------------ */
<a name="42"></a>/*
<a name="43"></a> *   canInherit - determine if there's anything to inherit from the current
<a name="44"></a> *   method.  Returns true if there's a method to inherit, nil if
<a name="45"></a> *   'inherited' in the current context would not invoke any code.
<a name="46"></a> */
<a name="47"></a>#define canInherit() \
<a name="48"></a>    propInherited(targetprop, targetobj, definingobj, PropDefAny)
<a name="49"></a>
<a name="50"></a>
<a name="51"></a>/* ------------------------------------------------------------------------ */
<a name="52"></a>/*
<a name="53"></a> *   Generic part of speech for "miscellaneous word."  We use this to
<a name="54"></a> *   classify words in unstructured phrases; it can apply to any token.
<a name="55"></a> *   Note that dictionary entries are never made with this word type, so
<a name="56"></a> *   it's not specific to any language; this is merely for flagging words in
<a name="57"></a> *   unstructured phrases in grammar matches.
<a name="58"></a> */
<a name="59"></a>dictionary property miscWord;
<a name="60"></a>
<a name="61"></a>/*
<a name="62"></a> *   Generic part of speech for SpecialTopic words.  We enter special topic
<a name="63"></a> *   keywords into the parser dictionary so that they're not flagged as
<a name="64"></a> *   unknown words if they're used out of context.
<a name="65"></a> */
<a name="66"></a>dictionary property specialTopicWord;
<a name="67"></a>
<a name="68"></a>
<a name="69"></a>/* ------------------------------------------------------------------------ */
<a name="70"></a>/*
<a name="71"></a> *   If we're compiling for debugging, automatically include the parser
<a name="72"></a> *   debug code, which allows certain information on the parsing process
<a name="73"></a> *   (such as grammar match trees) to be displayed each time a command is
<a name="74"></a> *   typed.
<a name="75"></a> *
<a name="76"></a> *   Note that you can turn on parser debugging independently of full
<a name="77"></a> *   compiler debug information simply by explicitly defining PARSER_DEBUG
<a name="78"></a> *   (with the t3make -D option, for example).
<a name="79"></a> */
<a name="80"></a>#ifdef __DEBUG
<a name="81"></a>#define PARSER_DEBUG
<a name="82"></a>#endif
<a name="83"></a>
<a name="84"></a>/*
<a name="85"></a> *   Define some convenience macros for parser debug operations.  When
<a name="86"></a> *   PARSER_DEBUG isn't defined, these macros expand out to nothing.
<a name="87"></a> */
<a name="88"></a>#ifdef PARSER_DEBUG
<a name="89"></a>
<a name="90"></a>#define dbgShowGrammarList(lst) showGrammarList(lst)
<a name="91"></a>#define dbgShowGrammarWithCaption(headline, match) \
<a name="92"></a>    showGrammarWithCaption(headline, match)
<a name="93"></a>
<a name="94"></a>#else /* PARSER_DEBUG */
<a name="95"></a>
<a name="96"></a>#define dbgShowGrammarList(lst)
<a name="97"></a>#define dbgShowGrammarWithCaption(headline, match)
<a name="98"></a>
<a name="99"></a>#endif /* PARSER_DEBUG */
<a name="100"></a>
<a name="101"></a>
<a name="102"></a>/* ------------------------------------------------------------------------ */
<a name="103"></a>/*
<a name="104"></a> *   Parser global variables giving information on the command currently
<a name="105"></a> *   being performed.  These are valid through doAction processing.  These
<a name="106"></a> *   should never be changed except by the parser.
<a name="107"></a> */
<a name="108"></a>
<a name="109"></a>/* the actor performing the current command */
<a name="110"></a>#define gActor (libGlobal.curActor)
<a name="111"></a>
<a name="112"></a>/*
<a name="113"></a> *   For convenience, define some macros that return the current direct and
<a name="114"></a> *   indirect objects from the current action.  The library only uses direct
<a name="115"></a> *   and indirect objects, so games that define additional command objects
<a name="116"></a> *   will have to add their own similar macros for those.
<a name="117"></a> */
<a name="118"></a>#define gDobj (gAction.getDobj())
<a name="119"></a>#define gIobj (gAction.getIobj())
<a name="120"></a>
<a name="121"></a>/*
<a name="122"></a> *   Get the current ResolvedTopic, and the literal text of the topic phrase
<a name="123"></a> *   as the user typed it (but converted to lower case).  These are
<a name="124"></a> *   applicable when the current action has a topic phrase.
<a name="125"></a> */
<a name="126"></a>#define gTopic (gAction.getTopic())
<a name="127"></a>#define gTopicText (gTopic.getTopicText.toLower())
<a name="128"></a>
<a name="129"></a>/* get the current literal phrase text, when the command has one */
<a name="130"></a>#define gLiteral (gAction.getLiteral())
<a name="131"></a>
<a name="132"></a>/*
<a name="133"></a> *   The tentative pre-resolution lists for the direct and indirect objects.
<a name="134"></a> *   When we're resolving an object of a multi-object command, these
<a name="135"></a> *   pre-resolution lists are available for the later-resolved objects.
<a name="136"></a> *
<a name="137"></a> *   Note that these values are list of ResolveInfo objects.  The obj_
<a name="138"></a> *   property of a list entry gives the entry's game-world object.
<a name="139"></a> *
<a name="140"></a> *   These lists do not provide the final resolution lists for the objects;
<a name="141"></a> *   rather, they provide a tentative set of possibilities based on the
<a name="142"></a> *   information that's available without knowing the results of resolving
<a name="143"></a> *   the earlier-resolved objects yet.
<a name="144"></a> *
<a name="145"></a> *   These are not meaningful when resolving single-object actions.
<a name="146"></a> */
<a name="147"></a>#define gTentativeDobj (gAction.getTentativeDobj())
<a name="148"></a>#define gTentativeIobj (gAction.getTentativeIobj())
<a name="149"></a>
<a name="150"></a>/*
<a name="151"></a> *   the actor who *issued* the current command (this is usually the player
<a name="152"></a> *   character, because most commands are initiated by the player on the
<a name="153"></a> *   command line, but it is also possible for one actor to send a command
<a name="154"></a> *   to another programmatically)
<a name="155"></a> */
<a name="156"></a>#define gIssuingActor (libGlobal.curIssuingActor)
<a name="157"></a>
<a name="158"></a>/* the Action object of the command being executed */
<a name="159"></a>#define gAction (libGlobal.curAction)
<a name="160"></a>
<a name="161"></a>/*
<a name="162"></a> *   Determine if the current global action is the specified action.  Only
<a name="163"></a> *   the action prefix is needed - so use "Take" rather than "TakeAction"
<a name="164"></a> *   here.
<a name="165"></a> *
<a name="166"></a> *   This tests to see if the current global action is an instance of the
<a name="167"></a> *   given action class - we test that it's an instance rather than the
<a name="168"></a> *   action class itself because the parser creates an instance of the
<a name="169"></a> *   action when it matches the action's syntax.
<a name="170"></a> */
<a name="171"></a>#define gActionIs(action) \
<a name="172"></a>    (gAction != nil &amp;&amp; gAction.actionOfKind(action##Action))
<a name="173"></a>
<a name="174"></a>/* is the current global action ANY of the specified actions? */
<a name="175"></a>#define gActionIn(action...) \
<a name="176"></a>    (gAction != nil \
<a name="177"></a>     &amp;&amp; (action#foreach/gAction.actionOfKind(action##Action)/||/))
<a name="178"></a>
<a name="179"></a>/* the verification results object - this is valid during verification */
<a name="180"></a>#define gVerifyResults (libGlobal.curVerifyResults)
<a name="181"></a>
<a name="182"></a>/* the command transcript object - this is valid during command execution */
<a name="183"></a>#define gTranscript (mainOutputStream.curTranscript)
<a name="184"></a>
<a name="185"></a>/*
<a name="186"></a> *   Some message processors add their own special parameters to messages,
<a name="187"></a> *   because they want to use expansion parameters (in the "{the dobj/him}"
<a name="188"></a> *   format) outside of the set of objects directly involved in the command.
<a name="189"></a> *
<a name="190"></a> *   The Action method setMessageParam() lets you define such a parameter,
<a name="191"></a> *   but for convenience, we define this macro for setting one or more
<a name="192"></a> *   parameters whose names exactly match their local variable names.  In
<a name="193"></a> *   other words, if you call this macro like this:
<a name="194"></a> *
<a name="195"></a> *   gMessageParams(obj, cont)
<a name="196"></a> *
<a name="197"></a> *   then you'll get one parameter with the text name 'obj' whose expansion
<a name="198"></a> *   will be the value of the local variable obj, and another with text name
<a name="199"></a> *   'cont' whose expansion is the value of the local variable cont.
<a name="200"></a> */
<a name="201"></a>#define gMessageParams(var...) \
<a name="202"></a>    (gAction.setMessageParams(var#foreach/#@var, var/,/))
<a name="203"></a>
<a name="204"></a>/*
<a name="205"></a> *   Synthesize a global message parameter name for the given object and
<a name="206"></a> *   return the synthesized name.  This is useful in cases where there might
<a name="207"></a> *   be repeated instances of global message parameters in the same action,
<a name="208"></a> *   so it's not safe to use a fixed name string for the object.  We'll
<a name="209"></a> *   create a unique global message parameter name, associate the object with
<a name="210"></a> *   the name, and return the name string.
<a name="211"></a> */
<a name="212"></a>#define gSynthMessageParam(var) (gAction.synthMessageParam(var))
<a name="213"></a>
<a name="214"></a>
<a name="215"></a>/* ------------------------------------------------------------------------ */
<a name="216"></a>/*
<a name="217"></a> *   Miscellaneous macros
<a name="218"></a> */
<a name="219"></a>
<a name="220"></a>/* get the current player character Actor object */
<a name="221"></a>#define gPlayerChar (libGlobal.playerChar)
<a name="222"></a>
<a name="223"></a>/*
<a name="224"></a> *   the exit lister object - if the exits module isn't included in the
<a name="225"></a> *   game, this will be nil
<a name="226"></a> */
<a name="227"></a>#define gExitLister (libGlobal.exitListerObj)
<a name="228"></a>
<a name="229"></a>/*
<a name="230"></a> *   the hint manager object - if the hints module isn't included in the
<a name="231"></a> *   game, this will be nil
<a name="232"></a> */
<a name="233"></a>#define gHintManager (libGlobal.hintManagerObj)
<a name="234"></a>
<a name="235"></a>
<a name="236"></a>/* ------------------------------------------------------------------------ */
<a name="237"></a>/*
<a name="238"></a> *   The current library messages object.  This is the source object for
<a name="239"></a> *   messages that don't logically relate to the actor carrying out the
<a name="240"></a> *   comamand.  It's mostly used for meta-command replies, and for text
<a name="241"></a> *   fragments that are used to construct descriptions.
<a name="242"></a> *
<a name="243"></a> *   This message object isn't generally used for parser messages or action
<a name="244"></a> *   replies - most of those come from the objects given by the current
<a name="245"></a> *   actor's getParserMessageObj() or getActionMessageObj(), respectively.
<a name="246"></a> *
<a name="247"></a> *   By default, this is set to libMessages.  The library never changes this
<a name="248"></a> *   itself, but a game can change this if it wants to switch to a new set of
<a name="249"></a> *   messages during a game.  (If you don't need to change messages during a
<a name="250"></a> *   game, but simply want to customize some of the default messages, you
<a name="251"></a> *   don't need to set this variable - you can simply use 'modify
<a name="252"></a> *   libMessages' instead.  This variable is designed for cases where you
<a name="253"></a> *   want to *dynamically* change the standard messages during the game.)
<a name="254"></a> */
<a name="255"></a>#define gLibMessages (libGlobal.libMessageObj)
<a name="256"></a>
<a name="257"></a>
<a name="258"></a>/* ------------------------------------------------------------------------ */
<a name="259"></a>/*
<a name="260"></a> *   readMainCommandTokens() phase identifiers.  We define a separate code
<a name="261"></a> *   for each kind of call to readMainCommandTokens() so that we can do any
<a name="262"></a> *   special token processing that depends on the type of command we're
<a name="263"></a> *   reading.
<a name="264"></a> *
<a name="265"></a> *   The library doesn't use the phase information itself for anything.
<a name="266"></a> *   These phase codes are purely for the author's use in writing
<a name="267"></a> *   pre-parsing functions and for differentiating prompts for the different
<a name="268"></a> *   types of input, as needed.
<a name="269"></a> *
<a name="270"></a> *   Games that read additional response types of their own are free to add
<a name="271"></a> *   their own enums to identify the additional phases.  Since the library
<a name="272"></a> *   doesn't need the phase information for anything internally, it won't
<a name="273"></a> *   confuse the library at all to add new game-specific phase codes.
<a name="274"></a> */
<a name="275"></a>
<a name="276"></a>/* reading a normal command line */
<a name="277"></a>enum rmcCommand;
<a name="278"></a>
<a name="279"></a>/* reading an unknown word response, to check for an "oops" command */
<a name="280"></a>enum rmcOops;
<a name="281"></a>
<a name="282"></a>/* reading a response to a prompt for a missing object phrase */
<a name="283"></a>enum rmcAskObject;
<a name="284"></a>
<a name="285"></a>/* reading a response to a prompt for a missing literal phrase */
<a name="286"></a>enum rmcAskLiteral;
<a name="287"></a>
<a name="288"></a>/* reading a response to an interactive disambiguation prompt */
<a name="289"></a>enum rmcDisambig;
<a name="290"></a>
<a name="291"></a>
<a name="292"></a>/* ------------------------------------------------------------------------ */
<a name="293"></a>/*
<a name="294"></a> *   Property set definitions
<a name="295"></a> */
<a name="296"></a>
<a name="297"></a>/* in debug mode, flag objFor definitions for non-existent actions */
<a name="298"></a>#ifdef __DEBUG
<a name="299"></a># define objForCheck(which, action) \
<a name="300"></a>    sentinel##which##action = __objref(action##Action, warn)
<a name="301"></a>#else
<a name="302"></a># define objForCheck(which, action)
<a name="303"></a>#endif
<a name="304"></a>
<a name="305"></a>#define objFor(which, action) \
<a name="306"></a>    objForCheck(which, action) \
<a name="307"></a>    propertyset '*' ## #@which ## #@action
<a name="308"></a>
<a name="309"></a>#define dobjFor(action) objFor(Dobj, action)
<a name="310"></a>#define iobjFor(action) objFor(Iobj, action)
<a name="311"></a>
<a name="312"></a>/*
<a name="313"></a> *   Treat an object definition as equivalent to another object definition.
<a name="314"></a> *   These can be used immediately after a dobjFor() or iobjFor() to treat
<a name="315"></a> *   the first action as though it were the second.  So, if the player types
<a name="316"></a> *   "search box", and we want to treat the direct object the same as for
<a name="317"></a> *   "look in box", we could make this definition for the box:
<a name="318"></a> *
<a name="319"></a> *   dobjFor(Search) asDobjFor(LookIn)
<a name="320"></a> *
<a name="321"></a> *   Note that no semicolon is needed after this definition, and that this
<a name="322"></a> *   definition is completely in lieu of a regular property set for the
<a name="323"></a> *   object action.
<a name="324"></a> *
<a name="325"></a> *   In general, a mapping should NOT change the role of an object:
<a name="326"></a> *   dobjFor(X) should not usually be mapped using asIobjFor(Y), and
<a name="327"></a> *   iobjFor(X) shouldn't be mapped using asDobjFor(Y).  The problem with
<a name="328"></a> *   changing the role is that the handler routines often assume that the
<a name="329"></a> *   object is actually in the role for which the handler was written; a
<a name="330"></a> *   verify handler might refer to '{dobj}' in generating a message, for
<a name="331"></a> *   example, so reversing the roles would give the wrong object in the role.
<a name="332"></a> *
<a name="333"></a> *   Role reversals should always be avoided, but can be used if necessary
<a name="334"></a> *   under conditions where all of the code involved in the TARGET of the
<a name="335"></a> *   mapping can be carefully controlled to ensure that it doesn't make
<a name="336"></a> *   assumptions about object roles, but only references 'self'.  Reversing
<a name="337"></a> *   roles in a mapping should never be attempted in general-purpose library
<a name="338"></a> *   code, because code based on the library could override the target of the
<a name="339"></a> *   role-reversing mapping, and the override could fail to observe the
<a name="340"></a> *   restrictions on object role references.
<a name="341"></a> *
<a name="342"></a> *   Note that role reversals can almost always be handled with other
<a name="343"></a> *   mechanisms that handle reversals cleanly.  Always consider remapTo()
<a name="344"></a> *   first when confronted with a situation that seems to call for a
<a name="345"></a> *   role-reversing asObjFor() mapping, as remapTo() specifically allows for
<a name="346"></a> *   object role changes.
<a name="347"></a> */
<a name="348"></a>#define asObjFor(obj, Action) \
<a name="349"></a>    { \
<a name="350"></a>        preCond { return preCond##obj##Action; } \
<a name="351"></a>        verify() { verify##obj##Action; } \
<a name="352"></a>        remap() { return remap##obj##Action; } \
<a name="353"></a>        check() { check##obj##Action; } \
<a name="354"></a>        action() { action##obj##Action; } \
<a name="355"></a>    }
<a name="356"></a>
<a name="357"></a>#define asDobjFor(action) asObjFor(Dobj, action)
<a name="358"></a>#define asIobjFor(action) asObjFor(Iobj, action)
<a name="359"></a>
<a name="360"></a>/*
<a name="361"></a> *   Define mappings of everything except the action.  This can be used in
<a name="362"></a> *   cases where we want to pick up the verification, preconditions, and
<a name="363"></a> *   check routines from another handler, but not the action.  This is often
<a name="364"></a> *   useful for two-object verbs where the action processing is entirely
<a name="365"></a> *   provided by one or the other object, so applying it to both would be
<a name="366"></a> *   redundant.
<a name="367"></a> */
<a name="368"></a>#define asObjWithoutActionFor(obj, Action) \
<a name="369"></a>    { \
<a name="370"></a>        preCond { return preCond##obj##Action; } \
<a name="371"></a>        verify() { verify##obj##Action; } \
<a name="372"></a>        remap() { return remap##obj##Action(); } \
<a name="373"></a>        check() { check##obj##Action; } \
<a name="374"></a>        action() {  } \
<a name="375"></a>    }
<a name="376"></a>
<a name="377"></a>#define asDobjWithoutActionFor(action) asObjWithoutActionFor(Dobj, action)
<a name="378"></a>#define asIobjWithoutActionFor(action) asObjWithoutActionFor(Iobj, action)
<a name="379"></a>
<a name="380"></a>/*
<a name="381"></a> *   "Remap" an action.  This effectively rewrites the action in the given
<a name="382"></a> *   form.  Each of the object slots can be filled either with a specific
<a name="383"></a> *   object, or with a noun phrase role name (DirectObject, IndirectObject);
<a name="384"></a> *   in the latter case, the object or objects from the named noun phrase
<a name="385"></a> *   role in the *current* action (i.e., before the rewrite) will be used.
<a name="386"></a> *
<a name="387"></a> *   If the new action has two or more objects (for example, if it's a
<a name="388"></a> *   TIAction), then EXACTLY ONE of the slots must be filled with a specific
<a name="389"></a> *   object, and all of the other slots must be filled with role names.  The
<a name="390"></a> *   specific object is the one that corresponds to the original object
<a name="391"></a> *   that's doing the remapping in the first place - this can simply be
<a name="392"></a> *   'self' if the new action will operate on the same object, or it can be
<a name="393"></a> *   a different object.  The important thing is that the 'verify' method
<a name="394"></a> *   for the defining object will be forwarded to the corresponding 'verify'
<a name="395"></a> *   method on the corresponding object for the new action.
<a name="396"></a> *
<a name="397"></a> *   This macro must be used as the ENTIRE definition block for a dobjFor()
<a name="398"></a> *   or iobjFor().  For example, to remap a "put in" command directed to a
<a name="399"></a> *   desk so that the command is instead applied to a drawer in the desk, we
<a name="400"></a> *   could define the following on the desk object:
<a name="401"></a> *
<a name="402"></a> *   iobjFor(PutIn) remapTo(PutIn, DirectObject, deskDrawer)
<a name="403"></a> */
<a name="404"></a>#define remapTo(action, objs...) { remap = [action##Action, ##objs] }
<a name="405"></a>
<a name="406"></a>/*
<a name="407"></a> *   Conditionally remap an action.  If 'cond' (a conditional expression)
<a name="408"></a> *   evaluated to true, we'll remap the action as directed; otherwise, we'll
<a name="409"></a> *   inherit the default handling
<a name="410"></a> */
<a name="411"></a>#define maybeRemapTo(cond, action, objs...) \
<a name="412"></a>    { remap = ((cond) ? [action##Action, ##objs] : inherited()) }
<a name="413"></a>
<a name="414"></a>
<a name="415"></a>/*
<a name="416"></a> *   For two-object push-travel actions, such as "push sled into cave",
<a name="417"></a> *   define a special mapping for both the direct and indirect objects:
<a name="418"></a> *
<a name="419"></a> *   - Map the direct object (the object being pushed) to a simple
<a name="420"></a> *   PushTravel action.  So, for "push sled into cave," map the direct
<a name="421"></a> *   object handling to PushTravel for the sled.  This makes the handling of
<a name="422"></a> *   the command equivalent to "push sled north" and the like.
<a name="423"></a> *
<a name="424"></a> *   - Map the indirect object (the travel connector) to use the PushTravel
<a name="425"></a> *   action's verify remapper.  This is handled specially by the PushTravel
<a name="426"></a> *   action object to handle the verification as though it were verifying
<a name="427"></a> *   the corresponding ordinary (non-push) travel action on the indirect
<a name="428"></a> *   object.  Beyond verification, we do nothing, since the direct object of
<a name="429"></a> *   a pushable object will handle the whole action using a nested travel
<a name="430"></a> *   action.
<a name="431"></a> *
<a name="432"></a> *   This effectively decomposes the two-object action into two coupled
<a name="433"></a> *   single-object actions: a regular PushTravel action on the object being
<a name="434"></a> *   pushed, and a regular whatever-kind-of-travel on the connector being
<a name="435"></a> *   traversed.  This handling has the appeal that it means that we don't
<a name="436"></a> *   need a separate PUSH version of every kind of allowed travel on a
<a name="437"></a> *   connector, and we don't need a special handler version for each kind of
<a name="438"></a> *   travel on a pushable object; instead, we just use the basic PushTravel
<a name="439"></a> *   and kind-of-travel handlers to form the combined form.  Note that this
<a name="440"></a> *   still allows separate treatment of the combined form wherever desired,
<a name="441"></a> *   just by overriding these default handlers for the two-object action.
<a name="442"></a> */
<a name="443"></a>#define mapPushTravelHandlers(pushAction, travelAction) \
<a name="444"></a>    dobjFor(pushAction) asDobjFor(PushTravel) \
<a name="445"></a>    mapPushTravelIobj(pushAction, travelAction)
<a name="446"></a>
<a name="447"></a>#define mapPushTravelIobj(pushAction, travelAction) \
<a name="448"></a>    iobjFor(pushAction) \
<a name="449"></a>    { \
<a name="450"></a>        verify() \
<a name="451"></a>            { gAction.verifyPushTravelIobj(self, travelAction##Action); } \
<a name="452"></a>    }
<a name="453"></a>
<a name="454"></a>
<a name="455"></a>/* ------------------------------------------------------------------------ */
<a name="456"></a>/*
<a name="457"></a> *   For an Actor, delegate an action handler to the ActorState object for
<a name="458"></a> *   processing.  You can use this any time you want to write the handlers
<a name="459"></a> *   for a particular action in the ActorState rather than in the Actor
<a name="460"></a> *   itself.  This would be desirable if the actor's response for a
<a name="461"></a> *   particular action varies considerably according to the actor's state.
<a name="462"></a> *   For example, if you want an actor's response to being attacked to be
<a name="463"></a> *   handled in the actor's current ActorState object, you could put this
<a name="464"></a> *   code in the Actor object:
<a name="465"></a> *
<a name="466"></a> *   dobjFor(AttackWith) actorStateDobjFor(AttackWith)
<a name="467"></a> *
<a name="468"></a> *   Once you've done this, you'd just write a normal dobjFor(AttackWith)
<a name="469"></a> *   handler in each of the ActorState objects associated with the actor.
<a name="470"></a> */
<a name="471"></a>#define actorStateObjFor(obj, Action) \
<a name="472"></a>    { \
<a name="473"></a>        preCond { return curState.preCond##obj##Action; } \
<a name="474"></a>        verify() { curState.verify##obj##Action; } \
<a name="475"></a>        remap() { return curState.remap##obj##Action; } \
<a name="476"></a>        check() { curState.check##obj##Action; } \
<a name="477"></a>        action() { curState.action##obj##Action; } \
<a name="478"></a>    }
<a name="479"></a>
<a name="480"></a>#define actorStateDobjFor(action) actorStateObjFor(Dobj, action)
<a name="481"></a>#define actorStateIobjFor(action) actorStateObjFor(Iobj, action)
<a name="482"></a>
<a name="483"></a>
<a name="484"></a>/* ------------------------------------------------------------------------ */
<a name="485"></a>/*
<a name="486"></a> *   Object role identifiers.  These are used to identify the role of a noun
<a name="487"></a> *   phrase in a command.
<a name="488"></a> *
<a name="489"></a> *   The library provides base classes for actions of zero, one, and two noun
<a name="490"></a> *   phrases in their grammars: "look", "take book", "put book on shelf".  We
<a name="491"></a> *   thus define role identifiers for direct and indirect objects.  Note that
<a name="492"></a> *   even though we stop there, this doesn't preclude games or library
<a name="493"></a> *   extensions from adding actions that take more than two noun phrases
<a name="494"></a> *   ("put coin in slot with tongs"); any such extensions must simply define
<a name="495"></a> *   their own additional role identifiers for the third or fourth (etc) noun
<a name="496"></a> *   phrase.
<a name="497"></a> */
<a name="498"></a>enum ActorObject, DirectObject, IndirectObject;
<a name="499"></a>
<a name="500"></a>/*
<a name="501"></a> *   A special role for the "other" object of a two-object command.  This
<a name="502"></a> *   can be used in certain contexts (such as remapTo) where a particular
<a name="503"></a> *   object role is implied by the context, and where the action involved
<a name="504"></a> *   has exactly two objects; OtherObject in such contexts means
<a name="505"></a> *   DirectObject when the implied role is IndirectObject, and vice versa.
<a name="506"></a> */
<a name="507"></a>enum OtherObject;
<a name="508"></a>
<a name="509"></a>
<a name="510"></a>/* ------------------------------------------------------------------------ */
<a name="511"></a>/*
<a name="512"></a> *   Pronoun types.  These are used to identify pronoun antecedents when
<a name="513"></a> *   resolving noun phrases involving pronouns.
<a name="514"></a> *
<a name="515"></a> *   We define a basic set of pronouns here that are common to most
<a name="516"></a> *   languages.  Language-specific modules are free to add their own pronoun
<a name="517"></a> *   types as needed.
<a name="518"></a> *
<a name="519"></a> *   Our basic set is:
<a name="520"></a> *
<a name="521"></a> *   'it' - the neuter singular
<a name="522"></a> *.  'him' - the masculine singular
<a name="523"></a> *.  'her' - the feminine singular
<a name="524"></a> *.  'them' - the ungendered plural
<a name="525"></a> *.  'you' - second person singular
<a name="526"></a> *.  'me' - first person singular
<a name="527"></a> *
<a name="528"></a> *   Note that the first-person and second-person pronouns are assigned
<a name="529"></a> *   meanings that can vary by context.  When a command is issued by the
<a name="530"></a> *   player character to the player character (i.e., the command comes from
<a name="531"></a> *   the player and no target actor is specified), these refer to the player
<a name="532"></a> *   character when the PC is in the appropriate referral person - if the
<a name="533"></a> *   game calls the PC "you", then the player calls the PC "me", and vice
<a name="534"></a> *   versa.  When a command is targeted to or issued by an actor other than
<a name="535"></a> *   the PC, then "you" refers to the command's target and "me" refers to
<a name="536"></a> *   the command's issuer.
<a name="537"></a> */
<a name="538"></a>enum PronounIt, PronounThem, PronounHim, PronounHer, PronounYou, PronounMe;
<a name="539"></a>
<a name="540"></a>
<a name="541"></a>/* ------------------------------------------------------------------------ */
<a name="542"></a>/*
<a name="543"></a> *   set the location property
<a name="544"></a> */
<a name="545"></a>+ property location;
<a name="546"></a>
<a name="547"></a>
<a name="548"></a>/* ------------------------------------------------------------------------ */
<a name="549"></a>/*
<a name="550"></a> *   Alternative exit definition.  This can be used to define a secondary
<a name="551"></a> *   direction that links to the same destination, via the same connector, as
<a name="552"></a> *   another direction.  It's frequently desirable to link multiple
<a name="553"></a> *   directions to the same exit; for example, a door leading north might
<a name="554"></a> *   also lead out, or a stairway to the north could lead up as well.
<a name="555"></a> *
<a name="556"></a> *   Use this as follows in a room's property list:
<a name="557"></a> *
<a name="558"></a> *.     out asExit(north)
<a name="559"></a> *
<a name="560"></a> *   (Note that there's no '=' sign.)
<a name="561"></a> *
<a name="562"></a> *   It's not necessary to use this macro to declare an alternative exit,
<a name="563"></a> *   since the alternatives can all point directly to the same connector as
<a name="564"></a> *   the original.  The only thing this macro does is to make the alternative
<a name="565"></a> *   exit unlisted - it won't be shown in the list of exits in the status
<a name="566"></a> *   line, and it won't be shown in "you can't go that way" messages.
<a name="567"></a> *
<a name="568"></a> *   Note that there's one common case where you should be careful with
<a name="569"></a> *   asExit(): if you have a room that has an exit in some compass direction,
<a name="570"></a> *   you might be tempted to make OUT the primary "direction" for the exit,
<a name="571"></a> *   and treat the equivalent compass as a synonym, with a line such as
<a name="572"></a> *   "south asExit(out)".  You should avoid doing this - do it the other way
<a name="573"></a> *   instead, with the compass direction as the primary direction and OUT as
<a name="574"></a> *   the synonym: "out asExit(south)".  The reason this is important is that
<a name="575"></a> *   if there's a nested room inside the location (such as a chair), OUT
<a name="576"></a> *   while in the nested room will mean to get out of the nested room.  If
<a name="577"></a> *   you make the compass direction primary and make OUT the synonym, the
<a name="578"></a> *   compass direction will be listed as an available exit both in the
<a name="579"></a> *   location and in any nested rooms within it.
<a name="580"></a> */
<a name="581"></a>#define asExit(dir) = static ((dir).createUnlistedProxy())
<a name="582"></a>
<a name="583"></a>
<a name="584"></a>/* ------------------------------------------------------------------------ */
<a name="585"></a>/*
<a name="586"></a> *   "Person" indices.  We define these as numbers rather than enums so that
<a name="587"></a> *   we can easily use these as list indices.
<a name="588"></a> */
<a name="589"></a>#define FirstPerson   1
<a name="590"></a>#define SecondPerson  2
<a name="591"></a>#define ThirdPerson   3
<a name="592"></a>
<a name="593"></a>
<a name="594"></a>/* ------------------------------------------------------------------------ */
<a name="595"></a>/*
<a name="596"></a> *   Transparency levels
<a name="597"></a> */
<a name="598"></a>
<a name="599"></a>/* the sense is passed without loss of detail */
<a name="600"></a>enum transparent;
<a name="601"></a>
<a name="602"></a>/* the sense is passed, but with a loss of detail associated with distance */
<a name="603"></a>enum distant;
<a name="604"></a>
<a name="605"></a>/*
<a name="606"></a> *   The sense is passed, but with attenuation of energy level.  No other
<a name="607"></a> *   obscuration of detail occurs; this is something like tinted glass that
<a name="608"></a> *   doesn't distort the transmitted sense but reduces the amount of energy.
<a name="609"></a> */
<a name="610"></a>enum attenuated;
<a name="611"></a>
<a name="612"></a>/*
<a name="613"></a> *   The sense is passed, but with a loss of detail due to an obscuring
<a name="614"></a> *   layer of material.  The energy level is also attenuated.  This is
<a name="615"></a> *   something like dirty or wavy glass that distorts an image transmitted
<a name="616"></a> *   through it but doesn't completely block out light.
<a name="617"></a> */
<a name="618"></a>enum obscured;
<a name="619"></a>
<a name="620"></a>/* the sense is not passed at all */
<a name="621"></a>enum opaque;
<a name="622"></a>
<a name="623"></a>
<a name="624"></a>/* ------------------------------------------------------------------------ */
<a name="625"></a>/*
<a name="626"></a> *   Size classes.  An object is large, medium, or small with respect to
<a name="627"></a> *   each sense; the size is used to determine how well the object can be
<a name="628"></a> *   sensed at a distance or when obscured.
<a name="629"></a> *
<a name="630"></a> *   What "size" means depends on the sense.  For sight, the size
<a name="631"></a> *   indicates the visual size of the object.  For hearing, the size
<a name="632"></a> *   indicates the loudness of the object.
<a name="633"></a> */
<a name="634"></a>
<a name="635"></a>/*
<a name="636"></a> *   Large - the object is large enough that its details can be sensed
<a name="637"></a> *   from a distance or through an obscuring medium.
<a name="638"></a> */
<a name="639"></a>enum large;
<a name="640"></a>
<a name="641"></a>/*
<a name="642"></a> *   Medium - the object can be sensed at a distance or when obscured, but
<a name="643"></a> *   not in any detail.  Most objects fall into this category.  Note that
<a name="644"></a> *   things that are parts of large objects should normally be medium.
<a name="645"></a> */
<a name="646"></a>enum medium;
<a name="647"></a>
<a name="648"></a>/*
<a name="649"></a> *   Small - the object cannot be sensed at a distance at all.  This is
<a name="650"></a> *   appropriate for detailed parts of medium-class objects.
<a name="651"></a> */
<a name="652"></a>enum small;
<a name="653"></a>
<a name="654"></a>
<a name="655"></a>/* ------------------------------------------------------------------------ */
<a name="656"></a>/*
<a name="657"></a> *   Path traversal operations.
<a name="658"></a> */
<a name="659"></a>
<a name="660"></a>/* traverse from the starting point of the path */
<a name="661"></a>enum PathFrom;
<a name="662"></a>
<a name="663"></a>/* traverse into the contents */
<a name="664"></a>enum PathIn;
<a name="665"></a>
<a name="666"></a>/* traverse out to the container */
<a name="667"></a>enum PathOut;
<a name="668"></a>
<a name="669"></a>/* traverse from an object to a peer at the same containment level */
<a name="670"></a>enum PathPeer;
<a name="671"></a>
<a name="672"></a>/*
<a name="673"></a> *   traverse through an object with no common container on either side of
<a name="674"></a> *   the traversal - this is used when we are traversing an object, such as a
<a name="675"></a> *   SenseConnector, that connects unrelated locations
<a name="676"></a> */
<a name="677"></a>enum PathThrough;
<a name="678"></a>
<a name="679"></a>/* traverse to the ending point of the path */
<a name="680"></a>enum PathTo;
<a name="681"></a>
<a name="682"></a>
<a name="683"></a>/* ------------------------------------------------------------------------ */
<a name="684"></a>/*
<a name="685"></a> *   Listing Options
<a name="686"></a> */
<a name="687"></a>
<a name="688"></a>/*
<a name="689"></a> *   use "tall" notation, which lists objects in a single column, one item
<a name="690"></a> *   per line (the default is "wide" notation, which creates a sentence
<a name="691"></a> *   with the object listing)
<a name="692"></a> */
<a name="693"></a>#define ListTall      0x0001
<a name="694"></a>
<a name="695"></a>/*
<a name="696"></a> *   Recursively list the contents of each item we list.
<a name="697"></a> *
<a name="698"></a> *   For a 'tall' list, this indicates that we'll show the listed contents
<a name="699"></a> *   of each item that we list, and the listed contents of those items, and
<a name="700"></a> *   so on, indenting each level to indicate the containment relationship.
<a name="701"></a> *
<a name="702"></a> *   For a 'wide' list, this indicates that we'll show the listed contents
<a name="703"></a> *   of each item in-line in the listing, as a parenthetic note.
<a name="704"></a> *
<a name="705"></a> *   For both types of listings, when this flag is set and the indent level
<a name="706"></a> *   is zero (indicating a top-level listing), after the main list, we'll
<a name="707"></a> *   show a separate list for the contents of each item in our list that
<a name="708"></a> *   isn't itself listable but has listed contents, or has contents with
<a name="709"></a> *   listed contents, and so on to any level.  For example, if we're showing
<a name="710"></a> *   a room description, and the room contains a desk that isn't listed
<a name="711"></a> *   because it's a fixed part of the room, we'll show a separate list of
<a name="712"></a> *   the desk's listed contents.
<a name="713"></a> */
<a name="714"></a>#define ListRecurse   0x0002
<a name="715"></a>
<a name="716"></a>/*
<a name="717"></a> *   use "long list" notation - separates items that contain sublists with
<a name="718"></a> *   special punctuation, to set off the individual items in the longer
<a name="719"></a> *   listing from the items in the sublists (for example, separates items
<a name="720"></a> *   with semicolons rather than commas)
<a name="721"></a> */
<a name="722"></a>#define ListLong      0x0004
<a name="723"></a>
<a name="724"></a>/*
<a name="725"></a> *   This is a recursive listing of the contents of an item.  This is set by
<a name="726"></a> *   showList() in calls it makes to recursive listing levels.
<a name="727"></a> */
<a name="728"></a>#define ListContents  0x0008
<a name="729"></a>
<a name="730"></a>/*
<a name="731"></a> *   Custom option bits.  Flag bits with this value and higher are reserved
<a name="732"></a> *   for use by individual lister subclasses.
<a name="733"></a> *
<a name="734"></a> *   To ensure compatibility with any future changes that involve adding
<a name="735"></a> *   more base lister flags, subclasses are encouraged to use the following
<a name="736"></a> *   mechanism.  DO NOT use #define to define your own custom subclass
<a name="737"></a> *   flags.  Instead, define a property of your lister subclass for each
<a name="738"></a> *   flag you need as follows:
<a name="739"></a> *
<a name="740"></a> *   myCustomFlag1 = ListerCustomFlag(1) // use 1 for the first flag
<a name="741"></a> *.  myCustomFlag2 = ListerCustomFlag(2) // etc
<a name="742"></a> *.  nextCustomFlag = ListerCustomFlag(3)
<a name="743"></a> *
<a name="744"></a> *   You DO NOT have to use the name 'myCustomFlag1' - use whatever name you
<a name="745"></a> *   like that describes the nature of the flag.  However, the last item
<a name="746"></a> *   MUST be called 'nextCustomFlag' - this ensures that any subclasses of
<a name="747"></a> *   your class will allocate their own flags with new values that don't
<a name="748"></a> *   conflict with any of yours.
<a name="749"></a> *
<a name="750"></a> *   Then, when a client of your Lister subclass needs to pass one of your
<a name="751"></a> *   flag to the Lister, it should simply evaluate your 'myCustomFlagN'
<a name="752"></a> *   property of your lister.  If you'd like, you can even #define a ListXxx
<a name="753"></a> *   macro that retrieves the value, for the convenience of your callers:
<a name="754"></a> *
<a name="755"></a> *   #define ListMyclassMyCustomFlag1 (Myclass.myCustomFlag1)
<a name="756"></a> */
<a name="757"></a>#define ListCustomFlag 0x0100
<a name="758"></a>
<a name="759"></a>#define ListerCustomFlag(n) static ((inherited.nextCustomFlag) &lt;&lt; ((n) - 1))
<a name="760"></a>
<a name="761"></a>
<a name="762"></a>/* ------------------------------------------------------------------------ */
<a name="763"></a>/*
<a name="764"></a> *   Spelled-out number options, for spellInt() and related functions.
<a name="765"></a> *
<a name="766"></a> *   Note that the interfaces to the number-spelling functions can vary by
<a name="767"></a> *   language, and that variation can include these flags.  Some language
<a name="768"></a> *   modules might ignore some of these generic flags or define additional
<a name="769"></a> *   language-specific flags.
<a name="770"></a> */
<a name="771"></a>
<a name="772"></a>/*
<a name="773"></a> *   Use tens of hundreds rather than thousands if possible - 1950 is
<a name="774"></a> *   'nineteen hundred fifty' rather than 'one thousand nine hundred
<a name="775"></a> *   fifty'.  This only works if the number (not including the millions
<a name="776"></a> *   and billions) is in the range 1,100 to 9,999, because we don't want
<a name="777"></a> *   to say something like 'one hundred twenty hundred' for 12,000.
<a name="778"></a> */
<a name="779"></a>#define SpellIntTeenHundreds    0x0001
<a name="780"></a>
<a name="781"></a>/*
<a name="782"></a> *   use 'and' before the tens - 125 is 'one hundred and twenty-five'
<a name="783"></a> *   rather than 'one hundred twenty-five'
<a name="784"></a> */
<a name="785"></a>#define SpellIntAndTens         0x0002
<a name="786"></a>
<a name="787"></a>/*
<a name="788"></a> *   put a comma after each power group - 123456 is 'one hundred
<a name="789"></a> *   twenty-three thousand, four hundred fifty-six'
<a name="790"></a> */
<a name="791"></a>#define SpellIntCommas          0x0004
<a name="792"></a>
<a name="793"></a>
<a name="794"></a>/* ------------------------------------------------------------------------ */
<a name="795"></a>/*
<a name="796"></a> *   Decimal number format options.  These are used with the number
<a name="797"></a> *   formatting functions to control the formatting of numbers displayed in
<a name="798"></a> *   decimal digit format.
<a name="799"></a> */
<a name="800"></a>
<a name="801"></a>/*
<a name="802"></a> *   Use a group separator character between digit groups, using the
<a name="803"></a> *   default setting in languageGlobals.
<a name="804"></a> */
<a name="805"></a>#define DigitFormatGroupSep     0x0001
<a name="806"></a>
<a name="807"></a>/*
<a name="808"></a> *   Explicitly use a comma/period to separate digit groups, overriding
<a name="809"></a> *   the current languageGlobals setting.
<a name="810"></a> */
<a name="811"></a>#define DigitFormatGroupComma   0x0002
<a name="812"></a>#define DigitFormatGroupPeriod  0x0004
<a name="813"></a>
<a name="814"></a>
<a name="815"></a>/* ------------------------------------------------------------------------ */
<a name="816"></a>/*
<a name="817"></a> *   aHref() flags
<a name="818"></a> */
<a name="819"></a>#define AHREF_Plain  0x0001    /* plain text hyperlink (no underline/color) */
<a name="820"></a>
<a name="821"></a>
<a name="822"></a>/* ------------------------------------------------------------------------ */
<a name="823"></a>/*
<a name="824"></a> *   ResolveInfo flags
<a name="825"></a> */
<a name="826"></a>
<a name="827"></a>/* the noun phrase ends with an adjective */
<a name="828"></a>#define EndsWithAdj      0x0001
<a name="829"></a>
<a name="830"></a>/*
<a name="831"></a> *   one of the words in the noun phrase was truncated from its full
<a name="832"></a> *   dictionary spelling
<a name="833"></a> */
<a name="834"></a>#define VocabTruncated   0x0002
<a name="835"></a>
<a name="836"></a>/*
<a name="837"></a> *   One or more plurals was truncated from its full dictionary spelling.
<a name="838"></a> *   (We specially distinguish plurals that are truncated, because in
<a name="839"></a> *   English a plural is usually formed by adding "s" or "es" to the end of
<a name="840"></a> *   the singular form of a noun, meaning that a given singular form is
<a name="841"></a> *   usually a leading substring of its plural.  When a singular noun is
<a name="842"></a> *   longer than the truncation limit, which is conventionally six
<a name="843"></a> *   characters, the singular will always match as a truncated version of
<a name="844"></a> *   the plural, so every time someone types in a singular it'll be treated
<a name="845"></a> *   as ambiguous between the singular and plural form.  So, in the English
<a name="846"></a> *   parser, we have a preference to ignore a truncated plural any time the
<a name="847"></a> *   word could also be interpreted as an untruncated singular, hence we
<a name="848"></a> *   note when we have a truncated plural.)
<a name="849"></a> */
<a name="850"></a>#define PluralTruncated  0x0004
<a name="851"></a>
<a name="852"></a>/*
<a name="853"></a> *   The object came from an 'all' phrase.  Normally, the only time this
<a name="854"></a> *   makes any difference is when deciding whether or not to mention which
<a name="855"></a> *   object we're acting upon; an 'all' object should normally be mentioned
<a name="856"></a> *   explicitly, as though the command had involved multiple objects,
<a name="857"></a> *   because otherwise it might not be clear to the user what object had
<a name="858"></a> *   actually matched 'all'.
<a name="859"></a> */
<a name="860"></a>#define MatchedAll       0x0008
<a name="861"></a>
<a name="862"></a>/*
<a name="863"></a> *   Always announce the object before executing the command on it.  This
<a name="864"></a> *   flag can be set for objects that match phrases whose meaning isn't
<a name="865"></a> *   necessarily known to the player, such as "all" (which selects objects
<a name="866"></a> *   based on the simulation state, which might not exactly match what the
<a name="867"></a> *   player had in mind) or "any book" (which might select arbitrarily from
<a name="868"></a> *   several possibilities, so the player can't know which we'll choose).
<a name="869"></a> */
<a name="870"></a>#define AlwaysAnnounce   0x0010
<a name="871"></a>
<a name="872"></a>/*
<a name="873"></a> *   The noun phrase describing this object was ambiguous, and the object
<a name="874"></a> *   was selected by automatic disambiguation in a context where it was
<a name="875"></a> *   clear which object was indicated.  This is used in cases where the
<a name="876"></a> *   objects not selected were all illogical for the action context.
<a name="877"></a> */
<a name="878"></a>#define ClearDisambig    0x0020
<a name="879"></a>
<a name="880"></a>/*
<a name="881"></a> *   The noun phase describing this object was ambiguous, and the object was
<a name="882"></a> *   selected by automatic disambiguation in a context where it was not
<a name="883"></a> *   perfectly clear which object was indicated.  This is used for cases
<a name="884"></a> *   where the objects selected were more logical than the objects not
<a name="885"></a> *   selected, but some of the unselected objects were still logical.
<a name="886"></a> *
<a name="887"></a> *   This flag doesn't mean that we chose arbitrarily, but rather that we
<a name="888"></a> *   chose the best object or objects from a field that included additional
<a name="889"></a> *   objects that, though not quite as good, were still valid.  We flag this
<a name="890"></a> *   case because the user *could* have meant to use one of the other valid
<a name="891"></a> *   objects, even though we consider it most likely that the user meant to
<a name="892"></a> *   use the one(s) we selected; so, we want to flag this so we can call the
<a name="893"></a> *   user's attention to our choice, to make it more likely that the user
<a name="894"></a> *   will immediately notice if we made the wrong choice.
<a name="895"></a> *
<a name="896"></a> *   Note that we can't have both ClearDisambig and UnclearDisambig at the
<a name="897"></a> *   same time, but we *can* have neither of these.  If neither flag is set
<a name="898"></a> *   for an object, it simply means that the object wasn't ambiguous to
<a name="899"></a> *   start with.  When the user explicitly picks an object interactively,
<a name="900"></a> *   the selected object is effectively unambiguous, so it won't have either
<a name="901"></a> *   flag set; even though it started off ambiguous, the user did all of the
<a name="902"></a> *   work of selecting the appropriate object, leaving things unambiguous in
<a name="903"></a> *   the end.
<a name="904"></a> */
<a name="905"></a>#define UnclearDisambig  0x0040
<a name="906"></a>
<a name="907"></a>/*
<a name="908"></a> *   The noun phrase was missing from the command and this object was
<a name="909"></a> *   supplied as an implicit default.
<a name="910"></a> */
<a name="911"></a>#define DefaultObject    0x0080
<a name="912"></a>
<a name="913"></a>/*
<a name="914"></a> *   We've announced this as a defaulted object.  We use this to ensure that
<a name="915"></a> *   we only make this type of announcement once, even if the opportunity to
<a name="916"></a> *   make the announcement comes up more than once; this can happen when
<a name="917"></a> *   we're asking for missing objects interactively in a multi-object
<a name="918"></a> *   command, since we might want to announce a default before prompting as
<a name="919"></a> *   well as before execution.
<a name="920"></a> */
<a name="921"></a>#define AnnouncedDefaultObject  0x0100
<a name="922"></a>
<a name="923"></a>
<a name="924"></a>/* ------------------------------------------------------------------------ */
<a name="925"></a>/*
<a name="926"></a> *   Announcement styles for disambiguated objects.  These are used in the
<a name="927"></a> *   gameMain object (see GameMainDef) to select which type of announcement
<a name="928"></a> *   is used when the parser disambiguates a noun phrase using the
<a name="929"></a> *   logicalness rules.
<a name="930"></a> */
<a name="931"></a>
<a name="932"></a>/*
<a name="933"></a> *   Announce unclear disambiguation results only.  When this setting is
<a name="934"></a> *   selected, the parser makes a parenthetical announcement (e.g., "(the red
<a name="935"></a> *   door)") when it selects an object based on likelihood rankings from
<a name="936"></a> *   among more than one logical match.  The parser makes no announcement
<a name="937"></a> *   when exactly one logical object is in scope, even if other objects match
<a name="938"></a> *   the noun phrase by name.
<a name="939"></a> */
<a name="940"></a>enum AnnounceUnclear;
<a name="941"></a>
<a name="942"></a>/*
<a name="943"></a> *   Announce clear and unclear disambiguation results, both using
<a name="944"></a> *   parenthetical announcement ("(the red door)").  When this setting is
<a name="945"></a> *   selected, the parser makes these announcements every time it applies the
<a name="946"></a> *   logicalness rules or likelihood rankings to disambiguate a noun phrase.
<a name="947"></a> *   There's no announcement when no disambiguation is needed (because the
<a name="948"></a> *   noun phrase matches only one in-scope object).
<a name="949"></a> */
<a name="950"></a>enum AnnounceClear;
<a name="951"></a>
<a name="952"></a>/*
<a name="953"></a> *   Describe clear disambiguation results, rather than announcing them.  The
<a name="954"></a> *   parser makes the parenthetical announcement, as usual, for unclear
<a name="955"></a> *   disambiguation picks, but not for clear picks (a clear pick is one where
<a name="956"></a> *   there's only one logical object, even though the noun phrase matches
<a name="957"></a> *   more than one object).  For clear picks, however, the parser uses a
<a name="958"></a> *   verbose version of the action reply in lieu of one of the terse default
<a name="959"></a> *   messages.  For example, rather than saying just "Taken", the parser
<a name="960"></a> *   would reply "You take the red book."  The longer messages mention the
<a name="961"></a> *   object by name, to make it clear exactly which one was chosen.
<a name="962"></a> */
<a name="963"></a>enum DescribeClear;
<a name="964"></a>
<a name="965"></a>
<a name="966"></a>/* ------------------------------------------------------------------------ */
<a name="967"></a>/*
<a name="968"></a> *   Inventory modes.  "Wide" mode displays the inventory in paragraph form;
<a name="969"></a> *   "tall" mode displays as a list, with one item per line, indenting items
<a name="970"></a> *   to reflect containment.
<a name="971"></a> */
<a name="972"></a>enum InventoryWide, InventoryTall;
<a name="973"></a>
<a name="974"></a>
<a name="975"></a>/* ------------------------------------------------------------------------ */
<a name="976"></a>/*
<a name="977"></a> *   Define an action with the given base class.  This adds the *Action
<a name="978"></a> *   suffix to the given root name, and defines a class with the given base
<a name="979"></a> *   class.  We also define the baseActionClass property to refer to myself;
<a name="980"></a> *   this is the canonical class representing the action for all subclasses.
<a name="981"></a> *   This information is useful because a language module might define
<a name="982"></a> *   several grammar rule subclasses for the given class; this lets us
<a name="983"></a> *   relate any instances of those various subclasses back to this same
<a name="984"></a> *   canonical class for the action if necessary.
<a name="985"></a> */
<a name="986"></a>#define DefineAction(name, baseClass...) \
<a name="987"></a>    class name##Action: ##baseClass \
<a name="988"></a>    baseActionClass = name##Action
<a name="989"></a>
<a name="990"></a>/*
<a name="991"></a> *   Define a "system" action.  System actions are meta-game commands, such
<a name="992"></a> *   as SAVE and QUIT, that generally operate the user interface and are not
<a name="993"></a> *   part of the game world.
<a name="994"></a> */
<a name="995"></a>#define DefineSystemAction(name) \
<a name="996"></a>    DefineAction(name, SystemAction)
<a name="997"></a>
<a name="998"></a>/*
<a name="999"></a> *   Define a concrete IAction, given the root name for the action.  We'll
<a name="1000"></a> *   automatically generate a class with name XxxAction.
<a name="1001"></a> */
<a name="1002"></a>#define DefineIAction(name) \
<a name="1003"></a>    DefineAction(name, IAction)
<a name="1004"></a>
<a name="1005"></a>/* define a conversational IAction, such as Hello, Goodbye, Yes, No */
<a name="1006"></a>#define DefineConvIAction(name) \
<a name="1007"></a>    DefineAction(name, ConvIAction)
<a name="1008"></a>
<a name="1009"></a>/*
<a name="1010"></a> *   Define a concrete TAction, given the root name for the action.  We'll
<a name="1011"></a> *   automatically generate a class with name XxxAction, a verProp with name
<a name="1012"></a> *   verXxx, a checkProp with name checkXxx, and an actionProp with name
<a name="1013"></a> *   actionDobjXxx.
<a name="1014"></a> */
<a name="1015"></a>#define DefineTAction(name) \
<a name="1016"></a>    DefineTActionSub(name, TAction)
<a name="1017"></a>
<a name="1018"></a>/*
<a name="1019"></a> *   Define a concrete TAction with a specific base class.
<a name="1020"></a> */
<a name="1021"></a>#define DefineTActionSub(name, cls) \
<a name="1022"></a>    DefineAction(name, cls) \
<a name="1023"></a>    verDobjProp = &amp;verifyDobj##name \
<a name="1024"></a>    remapDobjProp = &amp;remapDobj##name \
<a name="1025"></a>    preCondDobjProp = &amp;preCondDobj##name \
<a name="1026"></a>    checkDobjProp = &amp;checkDobj##name \
<a name="1027"></a>    actionDobjProp  = &amp;actionDobj##name \
<a name="1028"></a>
<a name="1029"></a>/*
<a name="1030"></a> *   Define a concrete TIAction, given the root name for the action.  We'll
<a name="1031"></a> *   automatically generate a class with name XxxAction, a verDobjProp with
<a name="1032"></a> *   name verDobjXxx, a verIobjProp with name verIobjxxx, a checkDobjProp
<a name="1033"></a> *   with name checkDobjXxx, a checkIobjProp with name checkIobjXxx, an
<a name="1034"></a> *   actionDobjProp with name actionDobjXxx, and an actionIobjProp with name
<a name="1035"></a> *   actionIobjXxx.
<a name="1036"></a> */
<a name="1037"></a>#define DefineTIAction(name) \
<a name="1038"></a>    DefineTIActionSub(name, TIAction)
<a name="1039"></a>
<a name="1040"></a>/*
<a name="1041"></a> *   Define a concrete TIAction with a specific base class.
<a name="1042"></a> */
<a name="1043"></a>#define DefineTIActionSub(name, cls) \
<a name="1044"></a>    DefineAction(name, cls) \
<a name="1045"></a>    verDobjProp = &amp;verifyDobj##name \
<a name="1046"></a>    verIobjProp = &amp;verifyIobj##name \
<a name="1047"></a>    remapDobjProp = &amp;remapDobj##name \
<a name="1048"></a>    remapIobjProp = &amp;remapIobj##name \
<a name="1049"></a>    preCondDobjProp = &amp;preCondDobj##name \
<a name="1050"></a>    preCondIobjProp = &amp;preCondIobj##name \
<a name="1051"></a>    checkDobjProp = &amp;checkDobj##name \
<a name="1052"></a>    checkIobjProp = &amp;checkIobj##name \
<a name="1053"></a>    actionDobjProp  = &amp;actionDobj##name \
<a name="1054"></a>    actionIobjProp = &amp;actionIobj##name
<a name="1055"></a>
<a name="1056"></a>/*
<a name="1057"></a> *   Define a concrete TopicAction, given the root name for the action.
<a name="1058"></a> */
<a name="1059"></a>#define DefineTopicAction(name) \
<a name="1060"></a>    DefineAction(name, TopicAction)
<a name="1061"></a>
<a name="1062"></a>/*
<a name="1063"></a> *   Define a concrete TopicTAction, given the root name for the action.
<a name="1064"></a> *   'which' gives the role the topic serves, for message generation purposes
<a name="1065"></a> *   - this should be one of the object role enums (DirectObject,
<a name="1066"></a> *   IndirectObject, etc) indicating which role the topic plays in the
<a name="1067"></a> *   action's grammar.
<a name="1068"></a> */
<a name="1069"></a>#define BaseDefineTopicTAction(name, which, cls) \
<a name="1070"></a>    DefineAction(name, cls) \
<a name="1071"></a>    verDobjProp = &amp;verifyDobj##name \
<a name="1072"></a>    remapDobjProp = &amp;remapDobj##name \
<a name="1073"></a>    preCondDobjProp = &amp;preCondDobj##name \
<a name="1074"></a>    checkDobjProp = &amp;checkDobj##name \
<a name="1075"></a>    actionDobjProp = &amp;actionDobj##name \
<a name="1076"></a>    whichMessageTopic = which
<a name="1077"></a>
<a name="1078"></a>#define DefineTopicTAction(name, which) \
<a name="1079"></a>    BaseDefineTopicTAction(name, which, TopicTAction)
<a name="1080"></a>
<a name="1081"></a>/*
<a name="1082"></a> *   Define a concrete ConvTopicTAction.  This is just like defining a
<a name="1083"></a> *   TopicTAction, but defines the action using the ConvTopicTAction
<a name="1084"></a> *   subclass.
<a name="1085"></a> */
<a name="1086"></a>#define DefineConvTopicTAction(name, which) \
<a name="1087"></a>    BaseDefineTopicTAction(name, which, ConvTopicTAction)
<a name="1088"></a>
<a name="1089"></a>/*
<a name="1090"></a> *   Define a concrete LiteralAction, given the root name for the action.
<a name="1091"></a> */
<a name="1092"></a>#define DefineLiteralAction(name) \
<a name="1093"></a>    DefineAction(name, LiteralAction)
<a name="1094"></a>
<a name="1095"></a>/*
<a name="1096"></a> *   Define a concrete LiteralTAction, given the root name for the action.
<a name="1097"></a> *   'which' gives the role the literal phrase serves, for message generation
<a name="1098"></a> *   purposes - this should be one of the object role enums (DirectObject,
<a name="1099"></a> *   IndirectObject, etc) indicating which role the topic plays in the
<a name="1100"></a> *   action's grammar.
<a name="1101"></a> */
<a name="1102"></a>#define DefineLiteralTAction(name, which) \
<a name="1103"></a>    DefineAction(name, LiteralTAction) \
<a name="1104"></a>    verDobjProp = &amp;verifyDobj##name \
<a name="1105"></a>    remapDobjProp = &amp;remapDobj##name \
<a name="1106"></a>    preCondDobjProp = &amp;preCondDobj##name \
<a name="1107"></a>    checkDobjProp = &amp;checkDobj##name \
<a name="1108"></a>    actionDobjProp = &amp;actionDobj##name \
<a name="1109"></a>    whichMessageLiteral = which
<a name="1110"></a>
<a name="1111"></a>/* ------------------------------------------------------------------------ */
<a name="1112"></a>/*
<a name="1113"></a> *   Convenience macros for setting verify results.
<a name="1114"></a> *
<a name="1115"></a> *   A verify routine can use these macros to set any number of verify
<a name="1116"></a> *   results.  The VerifyResultList will keep only the result that gives the
<a name="1117"></a> *   strongest disapproval of the action, since the verification process is
<a name="1118"></a> *   by its nature only interested in the most negative result.
<a name="1119"></a> *
<a name="1120"></a> *   These macros take advantage of the fact that we have a global
<a name="1121"></a> *   VerifyResultList object, which gathers the results of the verification,
<a name="1122"></a> *   so they can be used only in verify routines.  The global verification
<a name="1123"></a> *   results object is valid during each verification invocation.
<a name="1124"></a> */
<a name="1125"></a>
<a name="1126"></a>/*
<a name="1127"></a> *   Command is logical.  There's generally no need to add a logical result
<a name="1128"></a> *   explicitly, since a command is logical unless disapproved, but we
<a name="1129"></a> *   include this for completeness.
<a name="1130"></a> *
<a name="1131"></a> *   We use 100 as the default likelihood, to leave plenty of room for
<a name="1132"></a> *   specific likelihood rankings both above and below the default level.
<a name="1133"></a> */
<a name="1134"></a>#define logical \
<a name="1135"></a>    (gVerifyResults.addResult(new LogicalVerifyResult(100, '', 100)))
<a name="1136"></a>
<a name="1137"></a>/*
<a name="1138"></a> *   Command is logical, and is ranked as indicated among logical results.
<a name="1139"></a> *   The 'rank' value is the likelihood rank; the higher the rank, the more
<a name="1140"></a> *   logical the command is.  The rank is only used to establish an ordering
<a name="1141"></a> *   of the logical results; if a command also has illogical results, all of
<a name="1142"></a> *   the illogical results rank as less logical than the logical result with
<a name="1143"></a> *   the lowest likelihood.
<a name="1144"></a> *
<a name="1145"></a> *   The 'key' value is an arbitrary string value associated with the
<a name="1146"></a> *   ranking.  When two result lists both have a logical result object, and
<a name="1147"></a> *   both logical result objects have the same likelihood level, we'll check
<a name="1148"></a> *   the keys; if the keys match, we'll treat the two results as equivalent
<a name="1149"></a> *   and thus not distinguishing for disambiguation.  This is useful because
<a name="1150"></a> *   it creates a crude multivariate space for ranking items for
<a name="1151"></a> *   disambiguation.
<a name="1152"></a> *
<a name="1153"></a> *   For example, suppose we have a "put in" command, and we have two
<a name="1154"></a> *   possibilities for the target container.  Neither is being held by the
<a name="1155"></a> *   actor, so they both have a result with a logical rank of 70 with a key
<a name="1156"></a> *   value of 'not held'.  In addition, both are openable, and one is open
<a name="1157"></a> *   and the other is closed; the closed one has an additional result with a
<a name="1158"></a> *   logical rank of 80 and a key of 'not open'.  Which do we choose?  If we
<a name="1159"></a> *   looked only at the logical rankings, both would be equivalent, since
<a name="1160"></a> *   both have 70's as their most disapproving results.  However, we see
<a name="1161"></a> *   that the two 70's were applied for the same reason - because they share
<a name="1162"></a> *   a common key - so we know this information isn't helpful for
<a name="1163"></a> *   disambiguation and can be ignored.  So, we find that the closed one has
<a name="1164"></a> *   an 80, and the other has no other results (hence is by default logical
<a name="1165"></a> *   with rank 100), thus we take the '80' as the better one.
<a name="1166"></a> *
<a name="1167"></a> *   Throughout the library, we use the following conventions:
<a name="1168"></a> *
<a name="1169"></a> *   150 = especially good fit: a good candidate for the action that is
<a name="1170"></a> *   especially likely to be used with the command.  For example, a book is
<a name="1171"></a> *   especially suitable for a "read" command.
<a name="1172"></a> *
<a name="1173"></a> *   140 = similar to 150, but slightly less ideal a fit.  We use this for
<a name="1174"></a> *   objects that are excellent fits, but for which we know certain other
<a name="1175"></a> *   objects might be better fits.
<a name="1176"></a> *
<a name="1177"></a> *   100 = default: a perfectly good candidate for the action, with nothing
<a name="1178"></a> *   that would make it illogical, but nothing that makes it especially
<a name="1179"></a> *   likely, either
<a name="1180"></a> *
<a name="1181"></a> *   80 = slightly less than perfect: a good candidate, but with some
<a name="1182"></a> *   temporary and correctable attribute that may make it less likely than
<a name="1183"></a> *   others.  This is used for attributes that can be corrected: a container
<a name="1184"></a> *   needs to be opened for the action to succeed, but isn't currently open,
<a name="1185"></a> *   or an article of clothing cannot be worn for the action to proceeds,
<a name="1186"></a> *   but is currently being worn.
<a name="1187"></a> *
<a name="1188"></a> *   60/70 = slightly less than perfect, but with some attributes that can't
<a name="1189"></a> *   be readily corrected and which make the candidate potentially less
<a name="1190"></a> *   likely.  These are used to make guesses about which might object might
<a name="1191"></a> *   be intended when several are logical but some might be more readily
<a name="1192"></a> *   used than others; for example, if putting an object into a container, a
<a name="1193"></a> *   container being held might rank higher than one not being held, so the
<a name="1194"></a> *   one not being held might be ranked a "70" likelihood.
<a name="1195"></a> *
<a name="1196"></a> *   50 = logical but not especially likely: an acceptable candidate for the
<a name="1197"></a> *   action, but probably not the best choice for the action.  This is used
<a name="1198"></a> *   when an object can be used for the action, but would not be expected to
<a name="1199"></a> *   do anything special with the action.
<a name="1200"></a> */
<a name="1201"></a>#define logicalRank(rank, key)  \
<a name="1202"></a>    (gVerifyResults.addResult(new LogicalVerifyResult(rank, key, 100)))
<a name="1203"></a>
<a name="1204"></a>/*
<a name="1205"></a> *   Logical ranking with specific list ordering.  This is the same as a
<a name="1206"></a> *   regular logicalRank, but uses the given list ordering rather than the
<a name="1207"></a> *   default list ordering (100).
<a name="1208"></a> */
<a name="1209"></a>#define logicalRankOrd(rank, key, ord) \
<a name="1210"></a>    (gVerifyResults.addResult(new LogicalVerifyResult(rank, key, ord)))
<a name="1211"></a>
<a name="1212"></a>/* command is logical but dangerous */
<a name="1213"></a>#define dangerous \
<a name="1214"></a>    (gVerifyResults.addResult(new DangerousVerifyResult('')))
<a name="1215"></a>
<a name="1216"></a>/*
<a name="1217"></a> *   command is logical but non-obvious: the object should never be taken as
<a name="1218"></a> *   a default
<a name="1219"></a> */
<a name="1220"></a>#define nonObvious \
<a name="1221"></a>    (gVerifyResults.addResult(new NonObviousVerifyResult('')))
<a name="1222"></a>
<a name="1223"></a>/* command is currently (but not always) illogical, for the given reason */
<a name="1224"></a>#define illogicalNow(msg, params...) \
<a name="1225"></a>    (gVerifyResults.addResult(new IllogicalNowVerifyResult(msg, ##params)))
<a name="1226"></a>
<a name="1227"></a>/* illogical because things are already as the command would make them */
<a name="1228"></a>#define illogicalAlready(msg, params...) \
<a name="1229"></a>    (gVerifyResults.addResult( \
<a name="1230"></a>        new IllogicalAlreadyVerifyResult(msg, ##params)))
<a name="1231"></a>
<a name="1232"></a>/* command is always illogical */
<a name="1233"></a>#define illogical(msg, params...) \
<a name="1234"></a>    (gVerifyResults.addResult(new IllogicalVerifyResult(msg, ##params)))
<a name="1235"></a>
<a name="1236"></a>/* illogical since we're trying to use something on itself (eg, PUT X IN X) */
<a name="1237"></a>#define illogicalSelf(msg, params...) \
<a name="1238"></a>    (gVerifyResults.addResult(new IllogicalSelfVerifyResult(msg, ##params)))
<a name="1239"></a>
<a name="1240"></a>/* command is being performed on an inaccessible object */
<a name="1241"></a>#define inaccessible(msg, params...) \
<a name="1242"></a>    (gVerifyResults.addResult(new InaccessibleVerifyResult(msg, ##params)))
<a name="1243"></a>
<a name="1244"></a>
<a name="1245"></a>/* ------------------------------------------------------------------------ */
<a name="1246"></a>/*
<a name="1247"></a> *   Convenience macros for setting command results.
<a name="1248"></a> */
<a name="1249"></a>
<a name="1250"></a>/*
<a name="1251"></a> *   Set a default report for the current command.  This report will be
<a name="1252"></a> *   shown unless a non-default report is issued, or if the default report
<a name="1253"></a> *   is to be suppressed (for example, because the command is being
<a name="1254"></a> *   performed implicitly as part of another command).
<a name="1255"></a> *
<a name="1256"></a> *   Default reports should be used only for simple acknowledgments of the
<a name="1257"></a> *   command's successful completion - things like "Taken" or "Dropped" or
<a name="1258"></a> *   "Done."
<a name="1259"></a> *
<a name="1260"></a> *   Default responses are suppressed for implicit commands because they are
<a name="1261"></a> *   redundant.  When a command is performed implicitly, it is conventional
<a name="1262"></a> *   to mention the command being performed with a parenthetical: "(First
<a name="1263"></a> *   taking the book)".  In such cases, a simple acknowledgment that the
<a name="1264"></a> *   command was successfully performed would add nothing of use but would
<a name="1265"></a> *   merely make the output more verbose, so we omit it.
<a name="1266"></a> */
<a name="1267"></a>#define defaultReport(msg, params...) \
<a name="1268"></a>    (gTranscript.addReport(new DefaultCommandReport(msg, ##params)))
<a name="1269"></a>
<a name="1270"></a>/*
<a name="1271"></a> *   Set a default descriptive report for the current command.  This report
<a name="1272"></a> *   will be shown unless any other report is shown for the same command.
<a name="1273"></a> *   This differs from defaultReport in that we don't suppress a default
<a name="1274"></a> *   description for an implied command: we only suppress a default
<a name="1275"></a> *   description when there are other reports for the same command.
<a name="1276"></a> *
<a name="1277"></a> *   The purpose of the default descriptive report is to generate reports
<a name="1278"></a> *   that say things along the lines that there's nothing special to
<a name="1279"></a> *   describe.  For example:
<a name="1280"></a> *
<a name="1281"></a> *   &gt;x desk
<a name="1282"></a> *.  You see nothing special about it.
<a name="1283"></a> *
<a name="1284"></a> *   &gt;look in alcove
<a name="1285"></a> *.  There's nothing in the alcove.
<a name="1286"></a> *
<a name="1287"></a> *   When there's nothing else to report, these default descriptions are
<a name="1288"></a> *   suitable as the full response to the command.  However, they become
<a name="1289"></a> *   undesirable when we have other "status" information or related special
<a name="1290"></a> *   descriptions to display; consider:
<a name="1291"></a> *
<a name="1292"></a> *   &gt;x desk
<a name="1293"></a> *.  You see nothing special about it.
<a name="1294"></a> *.  Someone has jabbed a dagger into the top of the desk.
<a name="1295"></a> *
<a name="1296"></a> *   &gt;look in alcove
<a name="1297"></a> *.  There's nothing in the alcove.
<a name="1298"></a> *.  A vase is displayed in the alcove.
<a name="1299"></a> *
<a name="1300"></a> *   &gt;x bag
<a name="1301"></a> *.  You see nothing special about it.  It's open, and it contains
<a name="1302"></a> *.  a red book, an iron key, and a brass key.
<a name="1303"></a> *
<a name="1304"></a> *   In the first two examples above, we have special descriptions for
<a name="1305"></a> *   objects contained in the objects being described.  The special
<a name="1306"></a> *   descriptions essentially contradict the default descriptions' claims
<a name="1307"></a> *   that there's nothing special to mention, and also render the default
<a name="1308"></a> *   descriptions unnecessary, in that it would be enough to show just the
<a name="1309"></a> *   special descriptions.  The third example above is similar, but the
<a name="1310"></a> *   extra information is status information for the object being described
<a name="1311"></a> *   rather than a special description of a contained item; as with the
<a name="1312"></a> *   other examples, the generic default description is both contradictory
<a name="1313"></a> *   and unnecessary.
<a name="1314"></a> *
<a name="1315"></a> *   Default description reports should ONLY be used for messages that have
<a name="1316"></a> *   the character of the examples above: generic descriptions that indicate
<a name="1317"></a> *   explicitly that there's nothing special to report.  Messages that offer
<a name="1318"></a> *   any sort of descriptive detail should NOT be generated as default
<a name="1319"></a> *   description reports, because it is suitable and desirable to retain an
<a name="1320"></a> *   actual descriptive message even when other status information or
<a name="1321"></a> *   related special descriptions are also shown.
<a name="1322"></a> */
<a name="1323"></a>#define defaultDescReport(msg, params...) \
<a name="1324"></a>    (gTranscript.addReport(new DefaultDescCommandReport(msg, ##params)))
<a name="1325"></a>
<a name="1326"></a>/*
<a name="1327"></a> *   Add an cosmetic internal spacing report.  This type of report is used
<a name="1328"></a> *   to show spacing (usually a paragraph break) within command output.
<a name="1329"></a> *
<a name="1330"></a> *   The important thing about this report is that it doesn't trigger
<a name="1331"></a> *   suppression of any default reports.  This is useful when internal
<a name="1332"></a> *   separation is added on speculation that there might be some reports to
<a name="1333"></a> *   separate, but without certainty that there will actually be any reports
<a name="1334"></a> *   shown; for example, when preparing to show a list of special
<a name="1335"></a> *   descriptions, we might add some spacing just in case some special
<a name="1336"></a> *   descriptions will be shown, saving the trouble of checking to see if
<a name="1337"></a> *   anything actually needs to be shown.
<a name="1338"></a> */
<a name="1339"></a>#define cosmeticSpacingReport(msg, params...) \
<a name="1340"></a>    (gTranscript.addReport(new CosmeticSpacingCommandReport(msg, ##params)))
<a name="1341"></a>
<a name="1342"></a>/*
<a name="1343"></a> *   Add an "extra" report.  This is an incidental message that doesn't
<a name="1344"></a> *   affect the display of a default report.
<a name="1345"></a> */
<a name="1346"></a>#define extraReport(msg, params...) \
<a name="1347"></a>    (gTranscript.addReport(new ExtraCommandReport(msg, ##params)))
<a name="1348"></a>
<a name="1349"></a>/*
<a name="1350"></a> *   Set a main report for the current command.  This report will be shown
<a name="1351"></a> *   as the main report from the command, overriding any default report for
<a name="1352"></a> *   the command.
<a name="1353"></a> */
<a name="1354"></a>#define mainReport(msg, params...) \
<a name="1355"></a>    (gTranscript.addReport(new MainCommandReport(msg, ##params)))
<a name="1356"></a>
<a name="1357"></a>/*
<a name="1358"></a> *   Set a "before" report for the current command.  This report will be
<a name="1359"></a> *   shown before any main report, but will override any default report for
<a name="1360"></a> *   the command.
<a name="1361"></a> */
<a name="1362"></a>#define reportBefore(msg, params...) \
<a name="1363"></a>    (gTranscript.addReport(new BeforeCommandReport(msg, ##params)))
<a name="1364"></a>
<a name="1365"></a>/*
<a name="1366"></a> *   Set an "after" report for the current command.  This report will be
<a name="1367"></a> *   shown after any main report, but will override any default report for
<a name="1368"></a> *   the command.
<a name="1369"></a> */
<a name="1370"></a>#define reportAfter(msg, params...) \
<a name="1371"></a>    (gTranscript.addReport(new AfterCommandReport(msg, ##params)))
<a name="1372"></a>
<a name="1373"></a>/*
<a name="1374"></a> *   Report failure.  This overrides any default report, and marks the
<a name="1375"></a> *   command as having failed.
<a name="1376"></a> *
<a name="1377"></a> *   A failure report should NOT indicate any state change - this is
<a name="1378"></a> *   important because failure reports are suppressed under some conditions
<a name="1379"></a> *   (for example, when an NPC is performing an implied command, and the
<a name="1380"></a> *   implied command fails, we don't show the failure report).  If a failure
<a name="1381"></a> *   is accompanied by a state change, then a mainReport() should be made in
<a name="1382"></a> *   addition to the failure report - the main report should indicate the
<a name="1383"></a> *   state change.
<a name="1384"></a> */
<a name="1385"></a>#define reportFailure(msg, params...) \
<a name="1386"></a>    (gTranscript.addReport(new FailCommandReport(msg, ##params)))
<a name="1387"></a>
<a name="1388"></a>/*
<a name="1389"></a> *   Report a question.  This shows a report that's really an interactive
<a name="1390"></a> *   prompt for more information, such as a prompt for a missing object.
<a name="1391"></a> */
<a name="1392"></a>#define reportQuestion(msg, params...) \
<a name="1393"></a>    (gTranscript.addReport(new QuestionCommandReport(msg, ##params)))
<a name="1394"></a>
<a name="1395"></a>
<a name="1396"></a>/* ------------------------------------------------------------------------ */
<a name="1397"></a>/*
<a name="1398"></a> *   Thing message property overrides sometimes need to be selective about
<a name="1399"></a> *   the role of the object.  These macros let you specify that a Thing
<a name="1400"></a> *   message override is only in effect when the Thing is the direct or
<a name="1401"></a> *   indirect object.  When the object isn't in the specified role, the
<a name="1402"></a> *   message override will be ignored.
<a name="1403"></a> *
<a name="1404"></a> *   For example, suppose you want to override an object's response to PUT
<a name="1405"></a> *   IN, but *only* when it's the indirect object of PUT IN - *not* when the
<a name="1406"></a> *   object is itself being put somewhere.  To do this, you could give the
<a name="1407"></a> *   object a property like this:
<a name="1408"></a> *
<a name="1409"></a> *.    notAContainerMsg = iobjMsg('The vase\'s opening is too small. ')
<a name="1410"></a> *
<a name="1411"></a> *   This specifies that when the object is involved in a PUT IN command that
<a name="1412"></a> *   fails with the 'notAContainerMsg' message, the given message should be
<a name="1413"></a> *   used - but *only* when the object is the indirect object.
<a name="1414"></a> */
<a name="1415"></a>#define dobjMsg(msg) (gDobj == self ? msg : nil)
<a name="1416"></a>#define iobjMsg(msg) (gIobj == self ? msg : nil)
<a name="1417"></a>
<a name="1418"></a>
<a name="1419"></a>/* ------------------------------------------------------------------------ */
<a name="1420"></a>/*
<a name="1421"></a> *   Try performing a command implicitly.  The action is the root name of
<a name="1422"></a> *   the action, without the 'Action' suffix - we'll automatically add the
<a name="1423"></a> *   suffix.  'objs' is a varying-length list of the resolved objects in the
<a name="1424"></a> *   new action - the direct object, indirect object, and any others needed
<a name="1425"></a> *   for the action.
<a name="1426"></a> */
<a name="1427"></a>#define tryImplicitAction(action, objs...) \
<a name="1428"></a>    _tryImplicitAction(gIssuingActor, gActor, &amp;announceImplicitAction, \
<a name="1429"></a>    action##Action, ##objs)
<a name="1430"></a>
<a name="1431"></a>/*
<a name="1432"></a> *   Try performing a command implicitly, with a special descriptive
<a name="1433"></a> *   message.  'msgProp' gives the libMessages method to invoke the announce
<a name="1434"></a> *   the action, if the action is performed.  If 'msgProp' is nil, no
<a name="1435"></a> *   message is displayed at all.
<a name="1436"></a> *
<a name="1437"></a> *   'action' is the root name of the action, without the 'Action' suffix
<a name="1438"></a> *   (we'll automatically add the suffix).  'objs' is a varying-length list
<a name="1439"></a> *   of the resolved objects - direct object, indirect object, and any
<a name="1440"></a> *   others needed.
<a name="1441"></a> */
<a name="1442"></a>#define tryImplicitActionMsg(msgProp, action, objs...) \
<a name="1443"></a>    _tryImplicitAction(gIssuingActor, gActor, msgProp, \
<a name="1444"></a>                       action##Action, ##objs)
<a name="1445"></a>
<a name="1446"></a>/*
<a name="1447"></a> *   Replace the current action with a new action.  The new action will be
<a name="1448"></a> *   performed, and the original action will be terminated with 'exit'.
<a name="1449"></a> *
<a name="1450"></a> *   'action' is the root name of the action, without the 'Action' suffix
<a name="1451"></a> *   (we'll add the suffix automatically).  'objs' is a varying-length list
<a name="1452"></a> *   of the resolved objects - direct object, indirect object, etc.
<a name="1453"></a> */
<a name="1454"></a>#define replaceAction(action, objs...) \
<a name="1455"></a>    _replaceAction(gActor, action##Action, ##objs)
<a name="1456"></a>
<a name="1457"></a>/*
<a name="1458"></a> *   Replace the current action with a new action directed to a different
<a name="1459"></a> *   actor (but from the same issuing actor).
<a name="1460"></a> */
<a name="1461"></a>#define replaceActorAction(actor, action, objs...) \
<a name="1462"></a>    _replaceAction(actor, action##Action, ##objs)
<a name="1463"></a>
<a name="1464"></a>/*
<a name="1465"></a> *   Run a nested action.
<a name="1466"></a> */
<a name="1467"></a>#define nestedAction(action, objs...) \
<a name="1468"></a>    _nestedAction(nil, gActor, action##Action, ##objs)
<a name="1469"></a>
<a name="1470"></a>/*
<a name="1471"></a> *   Run a nested action targeted to a given actor.
<a name="1472"></a> */
<a name="1473"></a>#define nestedActorAction(actor, action, objs...) \
<a name="1474"></a>    _nestedAction(nil, actor, action##Action, ##objs)
<a name="1475"></a>
<a name="1476"></a>/*
<a name="1477"></a> *   Run a new action.  This is a brand new action run as a separate turn,
<a name="1478"></a> *   not as a nested action.  This doesn't replace any current action, but is
<a name="1479"></a> *   simply a separate action.
<a name="1480"></a> *
<a name="1481"></a> *   This is normally used only for internal actions that are run between
<a name="1482"></a> *   other actions.  This should not normally be used while another action is
<a name="1483"></a> *   being processed - use nestedAction for that instead.  This should also
<a name="1484"></a> *   not normally be used to replace the current action with another - use
<a name="1485"></a> *   replaceAction for that.
<a name="1486"></a> *
<a name="1487"></a> *   Returns a CommandTranscript object, which provides information on the
<a name="1488"></a> *   results of the action.
<a name="1489"></a> */
<a name="1490"></a>#define newAction(action, objs...) \
<a name="1491"></a>    _newAction(CommandTranscript, nil, gActor, action##Action, ##objs)
<a name="1492"></a>
<a name="1493"></a>/* run a new action with a specific actor */
<a name="1494"></a>#define newActorAction(actor, action, objs...) \
<a name="1495"></a>    _newAction(CommandTranscript, nil, actor, action##Action, ##objs)
<a name="1496"></a>
<a name="1497"></a>/*
<a name="1498"></a> *   Ask for a direct object and retry the command using the single-object
<a name="1499"></a> *   phrasing.  This can be used in the action() routine for a no-object
<a name="1500"></a> *   command to ask for the missing direct object.
<a name="1501"></a> *
<a name="1502"></a> *   In many cases, there is simply no grammar rule for a zero-object form
<a name="1503"></a> *   of a verb; in such cases, this macro is not needed, since the missing
<a name="1504"></a> *   object is handled via the grammar.  However, for some actions, it is
<a name="1505"></a> *   desirable to allow the zero-object phrasing some of the time, but
<a name="1506"></a> *   require the direct-object phrasing other times.  This macro exists for
<a name="1507"></a> *   these cases, because it allows the intransitive version of the action
<a name="1508"></a> *   to decide, on a case-by-case basis, whether to process the no-object
<a name="1509"></a> *   form of the command or to prompt for a direct object.
<a name="1510"></a> *
<a name="1511"></a> *   newAction is the root name (without the Action suffix) of the
<a name="1512"></a> *   transitive action to execute.  For example, if we're processing a plain
<a name="1513"></a> *   "in" command, we could use askForDobj(Enter) to ask for a direct object
<a name="1514"></a> *   for the transitive "enter" phrasing.
<a name="1515"></a> */
<a name="1516"></a>#define askForDobj(newAction) \
<a name="1517"></a>    (newAction##Action.retryWithMissingDobj(gAction, ResolveAsker))
<a name="1518"></a>
<a name="1519"></a>/*
<a name="1520"></a> *   Ask for an indirect object and retry the command using the two-object
<a name="1521"></a> *   phrasing.  This can be used in the action() routine of a single-object
<a name="1522"></a> *   command to ask for the missing indirect object.
<a name="1523"></a> *
<a name="1524"></a> *   In many cases, there is simply no grammar rule for a single-object form
<a name="1525"></a> *   of a verb; in such cases, this macro is not needed, since the missing
<a name="1526"></a> *   object is handled via the grammar.  However, for some actions, it is
<a name="1527"></a> *   desirable to allow the single-object phrasing some of the time, but
<a name="1528"></a> *   require the two-object phrasing other times.  This macro exists for
<a name="1529"></a> *   these cases, because it allows the action() routine to decide, on a
<a name="1530"></a> *   case-by-case basis, whether to process the single-object form of the
<a name="1531"></a> *   command or to prompt for an indirect object.
<a name="1532"></a> *
<a name="1533"></a> *   newAction is the root name (without the Action suffix) of the
<a name="1534"></a> *   two-object form of the action.  For example, if we're processing a
<a name="1535"></a> *   single-object "unlock" command, we would use askForIobj(UnlockWith) to
<a name="1536"></a> *   ask for an indirect object for the "unlock with" two-object phrasing.
<a name="1537"></a> */
<a name="1538"></a>#define askForIobj(newAction) \
<a name="1539"></a>    (newAction##Action.retryWithMissingIobj(gAction, ResolveAsker))
<a name="1540"></a>
<a name="1541"></a>/*
<a name="1542"></a> *   Ask for a literal phrase and retry the command using the two-object
<a name="1543"></a> *   phrasing.  This is analogous to askForDobj() and askForIobj(), but for
<a name="1544"></a> *   literal phrases; we effectively convert a TAction into a
<a name="1545"></a> *   LiteralTAction.
<a name="1546"></a> */
<a name="1547"></a>#define askForLiteral(newAction) \
<a name="1548"></a>    (newAction##Action.retryWithMissingLiteral(gAction))
<a name="1549"></a>
<a name="1550"></a>/*
<a name="1551"></a> *   Ask for a topic phrase and retry the command using the two-object
<a name="1552"></a> *   phrasing.
<a name="1553"></a> */
<a name="1554"></a>#define askForTopic(newAction) \
<a name="1555"></a>    (newAction##Action.retryWithMissingTopic(gAction))
<a name="1556"></a>
<a name="1557"></a>/* ------------------------------------------------------------------------ */
<a name="1558"></a>/*
<a name="1559"></a> *   Command interruption signal macros.
<a name="1560"></a> */
<a name="1561"></a>
<a name="1562"></a>/* a concise macro to throw an ExitSignal */
<a name="1563"></a>#define exit throw new ExitSignal()
<a name="1564"></a>
<a name="1565"></a>/* a concise macro to throw an ExitActionSignal */
<a name="1566"></a>#define exitAction throw new ExitActionSignal()
<a name="1567"></a>
<a name="1568"></a>/* a concise macro to throw an AbortImplicitSignal */
<a name="1569"></a>#define abortImplicit throw new AbortImplicitSignal()
<a name="1570"></a>
<a name="1571"></a>
<a name="1572"></a>/* ------------------------------------------------------------------------ */
<a name="1573"></a>/*
<a name="1574"></a> *   Flags for LOOK AROUND styles
<a name="1575"></a> */
<a name="1576"></a>
<a name="1577"></a>/* show the room name as part of the description */
<a name="1578"></a>#define LookRoomName       0x0001
<a name="1579"></a>
<a name="1580"></a>/* show the room's long desription (the roomDesc) */
<a name="1581"></a>#define LookRoomDesc       0x0002
<a name="1582"></a>
<a name="1583"></a>/* show the non-portable items (the specialDesc's) */
<a name="1584"></a>#define LookListSpecials   0x0004
<a name="1585"></a>
<a name="1586"></a>/* show the portable items */
<a name="1587"></a>#define LookListPortables  0x0008
<a name="1588"></a>
<a name="1589"></a>
<a name="1590"></a>/* ------------------------------------------------------------------------ */
<a name="1591"></a>/*
<a name="1592"></a> *   Template for multi-location objects.  To put a MultiLoc object in
<a name="1593"></a> *   several initial locations, simply use a template giving the list of
<a name="1594"></a> *   locations.
<a name="1595"></a> */
<a name="1596"></a>MultiLoc template [locationList];
<a name="1597"></a>
<a name="1598"></a>
<a name="1599"></a>/* ------------------------------------------------------------------------ */
<a name="1600"></a>/*
<a name="1601"></a> *   Templates for style tags
<a name="1602"></a> */
<a name="1603"></a>StyleTag template 'tagName' 'openText'? 'closeText'?;
<a name="1604"></a>
<a name="1605"></a>
<a name="1606"></a>/* ------------------------------------------------------------------------ */
<a name="1607"></a>/*
<a name="1608"></a> *   A template for footnotes - all we usually need to define in a footnote
<a name="1609"></a> *   is its descriptive text, so this makes it easy to define one.
<a name="1610"></a> */
<a name="1611"></a>Footnote template "desc";
<a name="1612"></a>
<a name="1613"></a>/* footnote status levels */
<a name="1614"></a>enum FootnotesOff, FootnotesMedium, FootnotesFull;
<a name="1615"></a>
<a name="1616"></a>
<a name="1617"></a>/* ------------------------------------------------------------------------ */
<a name="1618"></a>/*
<a name="1619"></a> *   An achievement defines its descriptive text.  It can also optionally
<a name="1620"></a> *   define the number of points it awards.
<a name="1621"></a> */
<a name="1622"></a>Achievement template +points? "desc";
<a name="1623"></a>
<a name="1624"></a>
<a name="1625"></a>/* ------------------------------------------------------------------------ */
<a name="1626"></a>/*
<a name="1627"></a> *   An event list takes a list of strings, objects, and/or functions.
<a name="1628"></a> */
<a name="1629"></a>EventList template [eventList];
<a name="1630"></a>
<a name="1631"></a>/*
<a name="1632"></a> *   A shuffled event list with two lists - the first list is the sequential
<a name="1633"></a> *   initial list, fired in the exact order specified; and the second is the
<a name="1634"></a> *   random list, with the events that occur in shuffled order after we
<a name="1635"></a> *   exhaust the initial list.
<a name="1636"></a> */
<a name="1637"></a>ShuffledEventList template [firstEvents] [eventList];
<a name="1638"></a>
<a name="1639"></a>/* a synchronized event list takes its state from another list */
<a name="1640"></a>SyncEventList template -&gt;masterObject inherited;
<a name="1641"></a>
<a name="1642"></a>/* low-level shuffled list */
<a name="1643"></a>ShuffledList template [valueList];
<a name="1644"></a>
<a name="1645"></a>
<a name="1646"></a>/* ------------------------------------------------------------------------ */
<a name="1647"></a>/*
<a name="1648"></a> *   Define a template for the Tip class.
<a name="1649"></a> */
<a name="1650"></a>Tip template "desc";
<a name="1651"></a>
<a name="1652"></a>
<a name="1653"></a>/* ------------------------------------------------------------------------ */
<a name="1654"></a>/*
<a name="1655"></a> *   Definitions for the menu system
<a name="1656"></a> */
<a name="1657"></a>
<a name="1658"></a>/*
<a name="1659"></a> *   The indices for the key values used to navigate menus, which are held
<a name="1660"></a> *   in the keyList array of MenuItems.
<a name="1661"></a> */
<a name="1662"></a>#define M_QUIT      1
<a name="1663"></a>#define M_PREV      2
<a name="1664"></a>#define M_UP        3
<a name="1665"></a>#define M_DOWN      4
<a name="1666"></a>#define M_SEL       5
<a name="1667"></a>
<a name="1668"></a>/* some templates for defining menu items */
<a name="1669"></a>MenuItem template 'title' 'heading'?;
<a name="1670"></a>MenuTopicItem template 'title' 'heading'? [menuContents];
<a name="1671"></a>MenuLongTopicItem template 'title' 'heading'? 'menuContents';
<a name="1672"></a>
<a name="1673"></a>/* templates for hint system objects */
<a name="1674"></a>Goal template -&gt;closeWhenAchieved? 'title' 'heading'? [menuContents];
<a name="1675"></a>Hint template 'hintText' [referencedGoals]?;
<a name="1676"></a>
<a name="1677"></a>/* ------------------------------------------------------------------------ */
<a name="1678"></a>/*
<a name="1679"></a> *   Templates for topic database entries.
<a name="1680"></a> */
<a name="1681"></a>
<a name="1682"></a>/*
<a name="1683"></a> *   A TopicEntry can be defined with an optional score, followed by the
<a name="1684"></a> *   match criteria (which can be either a single matching object, a list of
<a name="1685"></a> *   matching objects, or a regular expression pattern string), followed by
<a name="1686"></a> *   the optional response text (which can be given either as a double-quoted
<a name="1687"></a> *   string or as a list of single-quoted strings to use as an EventList).
<a name="1688"></a> */
<a name="1689"></a>TopicEntry template
<a name="1690"></a>   +matchScore?
<a name="1691"></a>   @matchObj | [matchObj] | 'matchPattern'
<a name="1692"></a>   "topicResponse" | [eventList] ?;
<a name="1693"></a>
<a name="1694"></a>/* a ShuffledEventList version of the above */
<a name="1695"></a>TopicEntry template
<a name="1696"></a>   +matchScore?
<a name="1697"></a>   @matchObj | [matchObj] | 'matchPattern'
<a name="1698"></a>   [firstEvents] [eventList];
<a name="1699"></a>
<a name="1700"></a>/* we can also include *both* the match object/list *and* pattern */
<a name="1701"></a>TopicEntry template
<a name="1702"></a>   +matchScore?
<a name="1703"></a>   @matchObj | [matchObj]
<a name="1704"></a>   'matchPattern'
<a name="1705"></a>   "topicResponse" | [eventList] ?;
<a name="1706"></a>
<a name="1707"></a>/* a ShuffledEventList version of the above */
<a name="1708"></a>TopicEntry template
<a name="1709"></a>   +matchScore?
<a name="1710"></a>   @matchObj | [matchObj]
<a name="1711"></a>   'matchPattern'
<a name="1712"></a>   [firstEvents] [eventList];
<a name="1713"></a>
<a name="1714"></a>/* miscellanous topics just specify the response text or list */
<a name="1715"></a>MiscTopic template "topicResponse" | [eventList];
<a name="1716"></a>MiscTopic template [firstEvents] [eventList];
<a name="1717"></a>
<a name="1718"></a>/*
<a name="1719"></a> *   A SpecialTopic takes a keyword list or a regular expression instead of
<a name="1720"></a> *   the regular match criteria.  It also takes a suggestion name string and
<a name="1721"></a> *   the normal response text.  There's no need for a score in a special
<a name="1722"></a> *   topic, since these are unique.
<a name="1723"></a> */
<a name="1724"></a>SpecialTopic template
<a name="1725"></a>   'name'
<a name="1726"></a>   [keywordList] | 'matchPat'
<a name="1727"></a>   "topicResponse" | [eventList] ?;
<a name="1728"></a>
<a name="1729"></a>/* a ShuffledEventList version of the above */
<a name="1730"></a>SpecialTopic template
<a name="1731"></a>   'name'
<a name="1732"></a>   [keywordList] | 'matchPat'
<a name="1733"></a>   [firstEvents] [eventList];
<a name="1734"></a>
<a name="1735"></a>/* default topics just specify the response text */
<a name="1736"></a>DefaultTopic template "topicResponse" | [eventList];
<a name="1737"></a>DefaultTopic template [firstEvents] [eventList];
<a name="1738"></a>
<a name="1739"></a>/* alternative topics just specify the response string or strings */
<a name="1740"></a>AltTopic template "topicResponse" | [eventList];
<a name="1741"></a>AltTopic template [firstEvents] [eventList];
<a name="1742"></a>
<a name="1743"></a>/* a TopicGroup can specify its score adjustment */
<a name="1744"></a>TopicGroup template +matchScoreAdjustment;
<a name="1745"></a>
<a name="1746"></a>/* a conversation node need a name */
<a name="1747"></a>ConvNode template 'name';
<a name="1748"></a>
<a name="1749"></a>/*
<a name="1750"></a> *   End-of-conversation reason codes
<a name="1751"></a> */
<a name="1752"></a>enum endConvBye;                                    /* player typed GOODBYE */
<a name="1753"></a>enum endConvTravel;         /* the other character is trying to travel away */
<a name="1754"></a>enum endConvBoredom;                /* our attentionSpan has been exhausted */
<a name="1755"></a>enum endConvActor;     /* the NPC itself (not the player) is saying GOODBYE */
<a name="1756"></a>
<a name="1757"></a>/*
<a name="1758"></a> *   Special result code for Actor.canEndConversation() - this indicates that
<a name="1759"></a> *   the other actor said something to force the conversation to keep going.
<a name="1760"></a> */
<a name="1761"></a>enum blockEndConv;
<a name="1762"></a>
<a name="1763"></a>/* ------------------------------------------------------------------------ */
<a name="1764"></a>/*
<a name="1765"></a> *   Conversation manager macros
<a name="1766"></a> */
<a name="1767"></a>
<a name="1768"></a>/* has a topic key been revealed through &lt;.reveal&gt;? */
<a name="1769"></a>#define gRevealed(key) (conversationManager.revealedNameTab[key] != nil)
<a name="1770"></a>
<a name="1771"></a>/* reveal a topic key, as though through &lt;.reveal&gt; */
<a name="1772"></a>#define gReveal(key) (conversationManager.setRevealed(key))
<a name="1773"></a>
<a name="1774"></a>/* mark a Topic/Thing as known/seen by the player character */
<a name="1775"></a>#define gSetKnown(obj) (gPlayerChar.setKnowsAbout(obj))
<a name="1776"></a>#define gSetSeen(obj) (gPlayerChar.setHasSeen(obj))
<a name="1777"></a>
<a name="1778"></a>
<a name="1779"></a>/* ------------------------------------------------------------------------ */
<a name="1780"></a>/*
<a name="1781"></a> *   For compatibility with versions before 3.1.1, define
<a name="1782"></a> *   openableContentsLister as a synonym for openableDescContentsLister.  The
<a name="1783"></a> *   former was renamed to the latter in 3.1.1 because the original name was
<a name="1784"></a> *   inconsistent with the corresponding listers for other classes.  In
<a name="1785"></a> *   principle, openableContentsLister is meant to be the 'contentsLister'
<a name="1786"></a> *   (for displaying the openable's contents in room descriptions, etc) for
<a name="1787"></a> *   an Openable, while openableDescContentsLister is its
<a name="1788"></a> *   'descContentsLister' (for displaying the openable's contents in its own
<a name="1789"></a> *   EXAMINE description).  Fortunately we don't have a need for a special
<a name="1790"></a> *   contentsLister for Openable, so we can avoid breaking existing code by
<a name="1791"></a> *   mapping the old name to the new name.
<a name="1792"></a> */
<a name="1793"></a>#define openableContentsLister openableDescContentsLister
<a name="1794"></a>
<a name="1795"></a>
<a name="1796"></a>#endif /* ADV3_H */
</pre>
<div class=ftr>TADS 3 Library Manual<br>Generated on 5/16/2013 from TADS version 3.1.3</div>
</body>
</html>
